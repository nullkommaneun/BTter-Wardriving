<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>BLE Scan – Fahrmodus (Hybrid, modular)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="app-version" content="1.6.4-modular" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self';
                 connect-src 'self' blob:;">
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div id="errorBanner" class="error">Fehler – Details in der Konsole</div>

  <header>
    <h1>BLE Scan <span class="badge">Fahrmodus</span> <small class="muted">v1.6.4-modular</small></h1>
    <div><span id="jsProbe" class="badge muted">JS lädt…</span></div>
    <div id="preflightStatus" class="muted">Preflight ausstehend…</div>
    <div id="status" class="muted">Bereit</div>

    <div class="stats">
      <div><span id="cntUnique">0</span><label>Einzigartige Geräte</label></div>
      <div><span id="cntPackets">0</span><label>Pakete gesamt</label></div>
      <div><span id="heartbeat">–</span><label>Heartbeat</label></div>
    </div>
  </header>

  <section class="controls">
    <button id="btnPreflight">Preflight prüfen</button>
    <button id="btnStart" title="Startet globalen BLE-Scan (requestLEScan)">Globaler Scan starten</button>
    <button id="btnStop" title="Scan(s) stoppen">Alle stoppen</button>
    <button id="btnResync" title="Globalen Scan neu initialisieren">Globaler Resync</button>
    <button id="btnAddWatch" title="Ein bestimmtes Gerät per watchAdvertisements abonnieren">Gerät hinzufügen (watch)</button>
    <div class="hint">
      Globaler Scan nutzt <code>requestLEScan</code>. Falls keine Events, mehrere Geräte per
      <code>watchAdvertisements()</code> hinzufügen (funktioniert zuverlässig).
    </div>
  </section>

  <section class="layout">
    <div class="panel">
      <h2>Aggregierte Geräte (Top 50)</h2>
      <ul id="devList" class="devlist"></ul>
    </div>

    <div class="panel">
      <h2>Beobachtete Geräte (watchAdvertisements)</h2>
      <div id="watchGrid" class="watch-grid"></div>
      <div class="hint">Hier erscheinen alle per „Gerät hinzufügen (watch)“ abonnierten Geräte mit Zählern.</div>
    </div>
  </section>

  <script type="module" src="./js/main.js?v=1.6.4"></script>
</body>
</html>